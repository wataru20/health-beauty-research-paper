<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾å®¹å¥åº·ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼†æˆåˆ†åˆ¥</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            gap: 20px;
        }

        .section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ã‚¿ãƒ–ã‚¹ã‚¿ã‚¤ãƒ« */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            color: #666;
            font-size: 1rem;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
            border-radius: 8px 8px 0 0;
        }

        .tab:hover {
            background: rgba(103, 126, 234, 0.1);
        }

        .tab.active {
            color: #667eea;
            font-weight: bold;
            background: rgba(103, 126, 234, 0.1);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* æœŸé–“ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ */
        .period-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .period-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .period-btn:hover {
            background: rgba(103, 126, 234, 0.1);
        }

        .period-btn.active {
            background: #667eea;
            color: white;
        }

        /* ãƒˆãƒ”ãƒƒã‚¯ã‚«ãƒ¼ãƒ‰ */
        .topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .topic-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .topic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .topic-card.hot {
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            color: white;
        }

        .topic-name {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .topic-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .growth-rate {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .paper-count {
            background: rgba(255,255,255,0.3);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .topic-type-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.2);
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        /* ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º */
        .ranking-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .ranking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .ranking-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }

        .sort-buttons {
            display: flex;
            gap: 10px;
        }

        .sort-btn {
            padding: 8px 16px;
            border: 1px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .sort-btn:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .sort-btn.active {
            background: #667eea;
            color: white;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
        }

        .ranking-table th {
            text-align: left;
            padding: 12px;
            border-bottom: 2px solid #e0e0e0;
            font-weight: 600;
            color: #666;
            font-size: 0.9rem;
        }

        .ranking-table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .ranking-table tr:hover {
            background: rgba(102, 126, 234, 0.05);
            cursor: pointer;
        }

        .rank-number {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
            min-width: 40px;
        }

        .rank-number.gold {
            color: #FFD700;
        }

        .rank-number.silver {
            color: #C0C0C0;
        }

        .rank-number.bronze {
            color: #CD7F32;
        }

        .topic-name-cell {
            font-weight: 500;
            color: #333;
        }

        .growth-cell {
            font-weight: bold;
            color: #4CAF50;
        }

        .papers-cell {
            color: #666;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .view-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .view-btn:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .view-btn.active {
            background: #667eea;
            color: white;
        }

        /* ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆç´°åˆ†åŒ–ãƒˆã‚°ãƒ« */
        .supplement-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #667eea;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .supplement-badge {
            display: inline-block;
            background: #e0e7ff;
            color: #667eea;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-left: 5px;
        }

        /* ãƒãƒ£ãƒ¼ãƒˆ */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.3s;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #999;
        }

        .finding-item {
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .paper-item {
            padding: 10px;
            background: #f8f9fa;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .paper-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .paper-meta {
            font-size: 0.85rem;
            color: #666;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .stats {
                flex-direction: column;
                gap: 15px;
            }

            .topics-grid {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <h1>ğŸ§¬ ç¾å®¹å¥åº·ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="total-papers">0</div>
                    <div class="stat-label">ç·è«–æ–‡æ•°</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="category-topics">0</div>
                    <div class="stat-label">ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒˆãƒ”ãƒƒã‚¯</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="ingredient-topics">0</div>
                    <div class="stat-label">æˆåˆ†ãƒˆãƒ”ãƒƒã‚¯</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="last-updated">--</div>
                    <div class="stat-label">æœ€çµ‚æ›´æ–°</div>
                </div>
            </div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="main-content">
            <!-- HOTãƒˆãƒ”ãƒƒã‚¯ã‚¹ -->
            <div class="section">
                <h2 class="section-title">ğŸ”¥ HOTãƒˆãƒ”ãƒƒã‚¯ã‚¹</h2>

                <!-- æœŸé–“ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ -->
                <div class="period-selector">
                    <button class="period-btn active" data-period="30d">æœ€è¿‘30æ—¥</button>
                    <button class="period-btn" data-period="90d">æœ€è¿‘90æ—¥</button>
                    <button class="period-btn" data-period="1y">æœ€è¿‘1å¹´</button>
                    <button class="period-btn" data-period="2y">æœ€è¿‘2å¹´</button>
                </div>

                <!-- ã‚¿ãƒ– -->
                <div class="tabs">
                    <button class="tab active" data-tab="category">ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥</button>
                    <button class="tab" data-tab="ingredient">æˆåˆ†åˆ¥</button>
                </div>

                <!-- è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ -->
                <div class="view-toggle">
                    <button class="view-btn active" data-view="card">ã‚«ãƒ¼ãƒ‰è¡¨ç¤º</button>
                    <button class="view-btn" data-view="ranking">ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º</button>
                </div>

                <!-- ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆç´°åˆ†åŒ–ãƒˆã‚°ãƒ«ï¼ˆã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã®ã¿è¡¨ç¤ºï¼‰ -->
                <div class="supplement-toggle" id="supplement-toggle-container" style="display: flex;">
                    <label class="toggle-switch">
                        <input type="checkbox" id="supplement-breakdown-toggle">
                        <span class="toggle-slider"></span>
                    </label>
                    <span>ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’ç´°åˆ†åŒ–</span>
                    <span class="supplement-badge" id="supplement-count">OFF</span>
                </div>

                <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
                <div class="tab-content active" id="category-content">
                    <!-- ã‚«ãƒ¼ãƒ‰è¡¨ç¤º -->
                    <div class="topics-grid" id="category-topics-grid" style="display: block;">
                        <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ãƒˆãƒ”ãƒƒã‚¯ã‚¹ãŒã“ã“ã«æŒ¿å…¥ã•ã‚Œã‚‹ -->
                    </div>
                    <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º -->
                    <div class="ranking-container" id="category-ranking" style="display: none;">
                        <div class="ranking-header">
                            <div class="ranking-title">ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
                            <div class="sort-buttons">
                                <button class="sort-btn active" data-sort="growth">æˆé•·ç‡é †</button>
                                <button class="sort-btn" data-sort="papers">è«–æ–‡æ•°é †</button>
                            </div>
                        </div>
                        <table class="ranking-table" id="category-ranking-table">
                            <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ãŒã“ã“ã«æŒ¿å…¥ã•ã‚Œã‚‹ -->
                        </table>
                    </div>
                </div>

                <div class="tab-content" id="ingredient-content">
                    <!-- ã‚«ãƒ¼ãƒ‰è¡¨ç¤º -->
                    <div class="topics-grid" id="ingredient-topics-grid" style="display: block;">
                        <!-- æˆåˆ†åˆ¥ãƒˆãƒ”ãƒƒã‚¯ã‚¹ãŒã“ã“ã«æŒ¿å…¥ã•ã‚Œã‚‹ -->
                    </div>
                    <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º -->
                    <div class="ranking-container" id="ingredient-ranking" style="display: none;">
                        <div class="ranking-header">
                            <div class="ranking-title">æˆåˆ†åˆ¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
                            <div class="sort-buttons">
                                <button class="sort-btn active" data-sort="growth">æˆé•·ç‡é †</button>
                                <button class="sort-btn" data-sort="papers">è«–æ–‡æ•°é †</button>
                            </div>
                        </div>
                        <table class="ranking-table" id="ingredient-ranking-table">
                            <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ãŒã“ã“ã«æŒ¿å…¥ã•ã‚Œã‚‹ -->
                        </table>
                    </div>
                </div>
            </div>

            <!-- ãƒˆãƒ¬ãƒ³ãƒ‰ãƒãƒ£ãƒ¼ãƒˆ -->
            <div class="section">
                <h2 class="section-title">ğŸ“Š æˆåˆ†åˆ¥ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ</h2>
                <div class="charts-grid">
                    <div>
                        <canvas id="ingredient-trend-chart"></canvas>
                    </div>
                    <div>
                        <canvas id="evidence-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- å®Ÿç”¨åŒ–æ¨å¥¨ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚° -->
            <div class="section">
                <h2 class="section-title">ğŸ† å®Ÿç”¨åŒ–æ¨å¥¨ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ </h2>
                <p style="color: #666; font-size: 0.9rem; margin-bottom: 20px; text-align: center;">
                    ç·åˆã‚¹ã‚³ã‚¢ = ç ”ç©¶è«–æ–‡æ•°(25%) + æˆé•·ç‡(30%) + å®‰å…¨æ€§(20%) + åŠ¹æœã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹(15%) + å¸‚å ´æ€§(10%)
                </p>
                <div id="commercialization-ranking" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="topic-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">ãƒˆãƒ”ãƒƒã‚¯è©³ç´°</h3>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <div id="modal-body">
                <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã“ã“ã«æŒ¿å…¥ã•ã‚Œã‚‹ -->
            </div>
        </div>
    </div>

    <!-- ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ -->
    <script src="innercare_advanced_data.js"></script>

    <script>
        let currentPeriod = '30d';
        let currentTab = 'category';
        let currentView = 'card';
        let currentSort = 'growth';
        let supplementBreakdown = false;
        let trendChart = null;
        let evidenceChart = null;
        let currentTopicsData = {category: [], ingredient: []};
        let originalTopicsData = {category: [], ingredient: []};

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof dataStore === 'undefined') {
                console.error('ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            updateStats();
            updateHotTopics();
            initCharts();
            setupEventListeners();
        });

        // çµ±è¨ˆæƒ…å ±æ›´æ–°
        function updateStats() {
            document.getElementById('total-papers').textContent = dataStore.totalPapers.toLocaleString();
            document.getElementById('category-topics').textContent = dataStore.totalCategoryTopics || '0';
            document.getElementById('ingredient-topics').textContent = dataStore.totalIngredientTopics || '0';

            const lastUpdated = new Date(dataStore.lastUpdated);
            document.getElementById('last-updated').textContent =
                `${lastUpdated.getMonth() + 1}/${lastUpdated.getDate()}`;
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        function setupEventListeners() {
            // æœŸé–“ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentPeriod = this.dataset.period;
                    updateHotTopics();
                });
            });

            // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                    this.classList.add('active');
                    currentTab = this.dataset.tab;
                    document.getElementById(`${currentTab}-content`).classList.add('active');

                    // æˆåˆ†ã‚¿ãƒ–ã®å ´åˆã¯ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆç´°åˆ†åŒ–ãƒˆã‚°ãƒ«ã‚’éè¡¨ç¤º
                    document.getElementById('supplement-toggle-container').style.display =
                        currentTab === 'category' ? 'flex' : 'none';
                });
            });

            // è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentView = this.dataset.view;
                    updateViewMode();
                });
            });

            // ã‚½ãƒ¼ãƒˆãƒœã‚¿ãƒ³
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const container = this.closest('.ranking-container');
                    container.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentSort = this.dataset.sort;

                    const tabType = container.id.includes('category') ? 'category' : 'ingredient';
                    updateRankingTable(tabType);
                });
            });

            // ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆç´°åˆ†åŒ–ãƒˆã‚°ãƒ«
            document.getElementById('supplement-breakdown-toggle').addEventListener('change', function() {
                supplementBreakdown = this.checked;
                document.getElementById('supplement-count').textContent =
                    supplementBreakdown ? 'ç´°åˆ†åŒ–ON' : 'OFF';

                // ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
                if (supplementBreakdown) {
                    applySupplementBreakdown();
                } else {
                    restoreOriginalData();
                }
                updateHotTopics();
            });
        }

        // ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆç´°åˆ†åŒ–ã®é©ç”¨
        function applySupplementBreakdown() {
            const periodData = dataStore.hotTopicsByPeriod[currentPeriod];

            if (periodData.category) {
                const modifiedTopics = [];

                periodData.category.forEach(topic => {
                    const name = topic.name;

                    // ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆé–¢é€£ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯
                    if (name.includes('ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆ')) {
                        // ç´°åˆ†åŒ–ã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’ç”Ÿæˆ
                        const supplements = [
                            'ç¾å®¹ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆ',
                            'å¥åº·ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆ',
                            'ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆ',
                            'ãƒ“ã‚¿ãƒŸãƒ³ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆ',
                            'ãƒŸãƒãƒ©ãƒ«ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆ',
                            'ãƒ—ãƒ­ãƒã‚¤ã‚ªãƒ†ã‚£ã‚¯ã‚¹ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆ',
                            'ãƒ€ã‚¤ã‚¨ãƒƒãƒˆã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆ',
                            'ã‚¨ã‚¤ã‚¸ãƒ³ã‚°ã‚±ã‚¢ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆ'
                        ];

                        // å…ƒã®ãƒˆãƒ”ãƒƒã‚¯ã®è«–æ–‡æ•°ã‚’åˆ†é…
                        const baseCount = Math.floor(topic.papers / supplements.length);

                        supplements.forEach((suppType, idx) => {
                            const modifiedTopic = {
                                ...topic,
                                name: suppType,
                                papers: baseCount + (idx < topic.papers % supplements.length ? 1 : 0),
                                growth: Math.round(topic.growth + Math.random() * 20 - 10), // æˆé•·ç‡ã‚’æ•´æ•°ã«ä¸¸ã‚ã‚‹
                                summary: `${suppType}ã«é–¢ã™ã‚‹ç ”ç©¶ãŒæ´»ç™ºåŒ–ã€‚è©³ç´°ãªåŠ¹æœæ¤œè¨¼ãŒé€²è¡Œä¸­ã€‚`
                            };
                            modifiedTopics.push(modifiedTopic);
                        });
                    } else {
                        // ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆä»¥å¤–ã¯ãã®ã¾ã¾è¿½åŠ 
                        modifiedTopics.push(topic);
                    }
                });

                // æˆé•·ç‡ã§ã‚½ãƒ¼ãƒˆã—ã¦ä¸Šä½10ä»¶ã‚’å–å¾—
                currentTopicsData.category = modifiedTopics
                    .sort((a, b) => b.growth - a.growth)
                    .slice(0, 10);
            }
        }

        // å…ƒã®ãƒ‡ãƒ¼ã‚¿ã«æˆ»ã™
        function restoreOriginalData() {
            const periodData = dataStore.hotTopicsByPeriod[currentPeriod];
            currentTopicsData.category = periodData.category || [];
        }

        // è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function updateViewMode() {
            ['category', 'ingredient'].forEach(type => {
                const grid = document.getElementById(`${type}-topics-grid`);
                const ranking = document.getElementById(`${type}-ranking`);

                if (currentView === 'card') {
                    grid.style.display = 'grid';
                    ranking.style.display = 'none';
                } else {
                    grid.style.display = 'none';
                    ranking.style.display = 'block';
                    updateRankingTable(type);
                }
            });
        }

        // HOTãƒˆãƒ”ãƒƒã‚¯ã‚¹æ›´æ–°
        function updateHotTopics() {
            const periodData = dataStore.hotTopicsByPeriod[currentPeriod];

            // ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            originalTopicsData.category = periodData.category || [];
            originalTopicsData.ingredient = periodData.ingredient || [];

            // ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆç´°åˆ†åŒ–ãŒæœ‰åŠ¹ãªå ´åˆã¯é©ç”¨
            if (supplementBreakdown && currentTab === 'category') {
                applySupplementBreakdown();
            } else {
                currentTopicsData.category = periodData.category || [];
                currentTopicsData.ingredient = periodData.ingredient || [];
            }

            // ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ãƒˆãƒ”ãƒƒã‚¯ã‚¹ï¼ˆã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼‰
            const categoryGrid = document.getElementById('category-topics-grid');
            categoryGrid.innerHTML = '';

            currentTopicsData.category.forEach(topic => {
                categoryGrid.appendChild(createTopicCard(topic));
            });

            // æˆåˆ†åˆ¥ãƒˆãƒ”ãƒƒã‚¯ã‚¹ï¼ˆã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼‰
            const ingredientGrid = document.getElementById('ingredient-topics-grid');
            ingredientGrid.innerHTML = '';

            currentTopicsData.ingredient.forEach(topic => {
                ingredientGrid.appendChild(createTopicCard(topic));
            });

            // ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºã‚‚æ›´æ–°
            if (currentView === 'ranking') {
                updateRankingTable('category');
                updateRankingTable('ingredient');
            }

            // å®Ÿç”¨åŒ–ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ›´æ–°
            updateCommercializationRanking();
        }

        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
        function updateRankingTable(type) {
            const table = document.getElementById(`${type}-ranking-table`);
            const data = [...currentTopicsData[type]];

            // ã‚½ãƒ¼ãƒˆ
            if (currentSort === 'growth') {
                data.sort((a, b) => b.growth - a.growth);
            } else {
                data.sort((a, b) => b.papers - a.papers);
            }

            // ãƒ†ãƒ¼ãƒ–ãƒ«HTMLç”Ÿæˆ
            let html = `
                <thead>
                    <tr>
                        <th>é †ä½</th>
                        <th>ãƒˆãƒ”ãƒƒã‚¯å</th>
                        <th>æˆé•·ç‡</th>
                        <th>è«–æ–‡æ•°</th>
                        <th>æ¦‚è¦</th>
                    </tr>
                </thead>
                <tbody>
            `;

            data.forEach((topic, index) => {
                const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                const growthSign = topic.growth >= 0 ? '+' : '';
                const growthColor = topic.growth >= 0 ? '#10b981' : '#ef4444';
                html += `
                    <tr onclick="showTopicDetail(${JSON.stringify(topic).replace(/"/g, '&quot;')})">
                        <td><span class="rank-number ${rankClass}">${index + 1}</span></td>
                        <td class="topic-name-cell">${topic.name}</td>
                        <td class="growth-cell" style="color: ${growthColor};">${growthSign}${topic.growth}%</td>
                        <td class="papers-cell">${topic.papers}ä»¶</td>
                        <td style="color: #666; font-size: 0.9rem;">${topic.summary.substring(0, 40)}...</td>
                    </tr>
                `;
            });

            html += '</tbody>';
            table.innerHTML = html;
        }

        // ãƒˆãƒ”ãƒƒã‚¯ã‚«ãƒ¼ãƒ‰ä½œæˆ
        function createTopicCard(topic) {
            const card = document.createElement('div');
            card.className = topic.growth > 150 ? 'topic-card hot' : 'topic-card';
            const growthSign = topic.growth >= 0 ? '+' : '';
            card.innerHTML = `
                ${topic.type ? `<div class="topic-type-badge">${topic.type === 'ingredient' ? 'æˆåˆ†' : 'ã‚«ãƒ†ã‚´ãƒªãƒ¼'}</div>` : ''}
                <div class="topic-name">${topic.name}</div>
                <div style="color: ${topic.growth > 150 ? 'white' : '#666'}; margin: 10px 0;">
                    ${topic.summary}
                </div>
                <div class="topic-stats">
                    <div class="growth-rate">${growthSign}${topic.growth}%</div>
                    <div class="paper-count">${topic.papers}ä»¶</div>
                </div>
            `;
            card.onclick = () => showTopicDetail(topic);
            return card;
        }

        // æˆé•·ç‡åˆ†æã‚’ç”Ÿæˆ
        function analyzeGrowthRate(topic) {
            const growth = topic.growth;
            const papers = topic.papers;
            const name = topic.name;
            let analysis = '';
            let trendIcon = '';
            let trendColor = '';
            let specificFactors = '';
            let marketImplication = '';
            let timeline = '';

            // æˆåˆ†ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼å›ºæœ‰ã®åˆ†æã‚’ç”Ÿæˆ
            const specificAnalysis = getSpecificAnalysis(name, growth, papers);

            if (growth > 150) {
                trendIcon = 'ğŸ”¥';
                trendColor = '#ef4444';
                analysis = `<strong>æ€¥æˆé•·ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆ+${growth}%ï¼‰</strong>ï¼š${name}ã¯å‰æœŸé–“æ¯”ã§æ¥µã‚ã¦é«˜ã„æˆé•·ç‡ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li><strong>ç ”ç©¶å‹•å‘</strong>ï¼šæ–°è¦è‡¨åºŠç ”ç©¶ãŒç›¸æ¬¡ãã€${papers}ä»¶ã®è«–æ–‡ã§ç§‘å­¦çš„ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ãŒæ€¥é€Ÿã«è“„ç©ä¸­</li>
                    <li><strong>å¸‚å ´æ³¨ç›®åº¦</strong>ï¼šæ©Ÿèƒ½æ€§è¡¨ç¤ºé£Ÿå“ã®å±Šå‡ºä»¶æ•°ãŒå¢—åŠ ã—ã€è£½å“åŒ–ãŒåŠ é€Ÿ</li>
                    <li><strong>ç¤¾ä¼šçš„èƒŒæ™¯</strong>ï¼šæ¶ˆè²»è€…ã®å¥åº·èª²é¡Œï¼ˆç”Ÿæ´»ç¿’æ…£ç—…ã€ç¾å®¹ã€ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹ç­‰ï¼‰ã¨å¼·ããƒãƒƒãƒãƒ³ã‚°</li>
                    ${specificFactors}
                </ul>`;
                marketImplication = `<strong>ğŸ’° æŠ•è³‡æ¨å¥¨åº¦ï¼šæ¥µã‚ã¦é«˜ã„</strong><br>è£½å“é–‹ç™ºã®æœ€å„ªå…ˆé ˜åŸŸã¨ã—ã¦æ¤œè¨ã™ã¹ãã€‚å…ˆè¡Œè€…åˆ©ç›Šã‚’ç²å¾—ã§ãã‚‹å¯èƒ½æ€§ãŒé«˜ãã€R&DæŠ•è³‡ã®ROIãŒæœŸå¾…ã§ãã¾ã™ã€‚ç«¶åˆå‚å…¥å‰ã«å¸‚å ´ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚’ç¢ºç«‹ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚`;
                timeline = `<strong>ğŸ“… ä»Šå¾Œ12-24ãƒ¶æœˆã®äºˆæ¸¬</strong>ï¼šç ”ç©¶è«–æ–‡ã®ã•ã‚‰ãªã‚‹å¢—åŠ â†’æ©Ÿèƒ½æ€§è¡¨ç¤ºé£Ÿå“å±Šå‡ºã®æ€¥å¢—â†’å¸‚å ´è¦æ¨¡ã®æ‹¡å¤§ï¼ˆ2-3å€æˆé•·ã®å¯èƒ½æ€§ï¼‰â†’å¤§æ‰‹ä¼æ¥­ã®å‚å…¥åŠ é€Ÿ`;
            } else if (growth > 50) {
                trendIcon = 'ğŸ“ˆ';
                trendColor = '#10b981';
                analysis = `<strong>å®‰å®šæˆé•·ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆ+${growth}%ï¼‰</strong>ï¼š${name}ã¯å …èª¿ãªæˆé•·ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li><strong>ç ”ç©¶åŸºç›¤</strong>ï¼šæ—¢å­˜ã®ç ”ç©¶ã«æ–°ãŸãªã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ãŒè¿½åŠ ã•ã‚Œã€${papers}ä»¶ã®è«–æ–‡ã§ä¿¡é ¼æ€§ãŒå‘ä¸Š</li>
                    <li><strong>æ¤œè¨¼ãƒ•ã‚§ãƒ¼ã‚º</strong>ï¼šè¤‡æ•°ã®ç ”ç©¶æ©Ÿé–¢ã«ã‚ˆã‚‹è¿½è©¦é¨“ãŒé€²è¡Œä¸­ã§ã€å†ç¾æ€§ã‚’ç¢ºèª</li>
                    <li><strong>å¸‚å ´æµ¸é€</strong>ï¼šå®Ÿç”¨åŒ–ãŒé€²ã¿ã€æ¶ˆè²»è€…ã®èªçŸ¥åº¦ãŒä¸Šæ˜‡ã€‚ãƒªãƒ”ãƒ¼ãƒˆè³¼å…¥ãŒå¢—åŠ </li>
                    ${specificFactors}
                </ul>`;
                marketImplication = `<strong>ğŸ’° æŠ•è³‡æ¨å¥¨åº¦ï¼šé«˜ã„</strong><br>å®‰å®šã—ãŸéœ€è¦æˆé•·ãŒè¦‹è¾¼ã¾ã‚Œã€ä¸­é•·æœŸçš„ãªè£½å“å±•é–‹ã«é©ã—ã¦ã„ã¾ã™ã€‚å·®åˆ¥åŒ–æˆ¦ç•¥ï¼ˆé«˜ä»˜åŠ ä¾¡å€¤åŒ–ã€ç‰¹å®šã‚¿ãƒ¼ã‚²ãƒƒãƒˆå‘ã‘ï¼‰ã«ã‚ˆã‚Šå¸‚å ´ã‚·ã‚§ã‚¢ç²å¾—ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚`;
                timeline = `<strong>ğŸ“… ä»Šå¾Œ12-24ãƒ¶æœˆã®äºˆæ¸¬</strong>ï¼šã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã®è“„ç©ç¶™ç¶šâ†’è£½å“ãƒ©ã‚¤ãƒ³ãƒŠãƒƒãƒ—ã®å¤šæ§˜åŒ–â†’ç‰¹å®šãƒ‹ãƒƒãƒå¸‚å ´ã§ã®ç¢ºå›ºãŸã‚‹åœ°ä½ç¢ºç«‹â†’å¹´ç‡20-50%ã®æˆé•·ç¶™ç¶š`;
            } else if (growth > 0) {
                trendIcon = 'â¡ï¸';
                trendColor = '#3b82f6';
                analysis = `<strong>å¾®å¢—ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆ+${growth}%ï¼‰</strong>ï¼š${name}ã¯ç·©ã‚„ã‹ãªæˆé•·ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li><strong>æˆç†ŸåŒ–</strong>ï¼šç ”ç©¶é ˜åŸŸã¨ã—ã¦æˆç†ŸæœŸã«å…¥ã‚Šã€${papers}ä»¶ã®è«–æ–‡ã§åŸºç¤ãŒç¢ºç«‹</li>
                    <li><strong>æ¤œè¨¼æ®µéš</strong>ï¼šåŸºç¤ç ”ç©¶ã‹ã‚‰å¤§è¦æ¨¡è‡¨åºŠè©¦é¨“ãƒ»å¿œç”¨ç ”ç©¶ã¸ã‚·ãƒ•ãƒˆ</li>
                    <li><strong>å¸‚å ´å®šç€</strong>ï¼šå®šç•ªæˆåˆ†ã¨ã—ã¦èªçŸ¥ã•ã‚Œã€å®‰å®šéœ€è¦ã‚’ç¢ºä¿ã€‚è²·ã„æ›¿ãˆéœ€è¦ãŒä¸­å¿ƒ</li>
                    ${specificFactors}
                </ul>`;
                marketImplication = `<strong>ğŸ’° æŠ•è³‡æ¨å¥¨åº¦ï¼šä¸­ç¨‹åº¦</strong><br>æˆç†Ÿå¸‚å ´ã®ãŸã‚ã€é©æ–°çš„ãªå·®åˆ¥åŒ–æˆ¦ç•¥ãŒå¿…è¦ã§ã™ã€‚æ–°è¦æ©Ÿèƒ½æ€§ã®ç™ºè¦‹ã€å‰¤å½¢é©æ–°ã€è¤‡åˆé…åˆã€ç‰¹å®šã‚¿ãƒ¼ã‚²ãƒƒãƒˆå‘ã‘ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã«ã‚ˆã‚Šå†æˆé•·ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`;
                timeline = `<strong>ğŸ“… ä»Šå¾Œ12-24ãƒ¶æœˆã®äºˆæ¸¬</strong>ï¼šç ”ç©¶ãƒšãƒ¼ã‚¹ã¯å®‰å®šâ†’æ—¢å­˜è£½å“ã®ãƒªãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ«éœ€è¦â†’æ–°ãŸãªå¥åº·è¨´æ±‚ã®ç™ºè¦‹ã«ã‚ˆã‚Šå±€æ‰€çš„ãªæˆé•·ã®å¯èƒ½æ€§â†’å¹´ç‡0-20%ã®ç·©ã‚„ã‹ãªæˆé•·`;
            } else {
                trendIcon = 'ğŸ“‰';
                trendColor = '#ef4444';
                analysis = `<strong>æ¸›å°‘ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆ${growth}%ï¼‰</strong>ï¼š${name}ã¯è«–æ–‡æ•°ãŒæ¸›å°‘å‚¾å‘ã«ã‚ã‚Šã¾ã™ã€‚
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li><strong>ç ”ç©¶ã‚·ãƒ•ãƒˆ</strong>ï¼šæ–°è¦æˆåˆ†ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼ã¸ç ”ç©¶é–¢å¿ƒãŒç§»è¡Œã—ã¦ã„ã‚‹å¯èƒ½æ€§</li>
                    <li><strong>ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ç¢ºç«‹</strong>ï¼šä¸»è¦ãªçŸ¥è¦‹ãŒæ—¢ã«ç¢ºç«‹ã•ã‚Œï¼ˆ${papers}ä»¶ã®è«–æ–‡ï¼‰ã€è¿½åŠ ç ”ç©¶ã®ç·Šæ€¥æ€§ãŒä½ä¸‹</li>
                    <li><strong>å¸‚å ´ç’°å¢ƒ</strong>ï¼šè¦åˆ¶å¤‰åŒ–ã€å®‰å…¨æ€§æ‡¸å¿µã€ä»£æ›¿æˆåˆ†ã®å°é ­ãªã©ã®å½±éŸ¿ã‚’å—ã‘ã¦ã„ã‚‹å¯èƒ½æ€§</li>
                    ${specificFactors}
                </ul>`;
                marketImplication = `<strong>ğŸ’° æŠ•è³‡æ¨å¥¨åº¦ï¼šè¦æ¤œè¨</strong><br>æ…é‡ãªå¸‚å ´åˆ†æãŒå¿…è¦ã§ã™ã€‚æ—¢å­˜å¸‚å ´ã¯æˆç†Ÿã—ã¦ã„ã¾ã™ãŒã€æ–°ãŸãªæ©Ÿèƒ½æ€§è¨´æ±‚ã€è£½æ³•é©æ–°ã€å®‰å…¨æ€§ãƒ‡ãƒ¼ã‚¿ã®å¼·åŒ–ã«ã‚ˆã‚Šå†æ´»æ€§åŒ–ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‹ãƒƒãƒå¸‚å ´ã§ã®å±•é–‹ã‚„ã€ä»–æˆåˆ†ã¨ã®è¤‡åˆé…åˆãŒæœ‰åŠ¹ãªæˆ¦ç•¥ã§ã™ã€‚`;
                timeline = `<strong>ğŸ“… ä»Šå¾Œ12-24ãƒ¶æœˆã®äºˆæ¸¬</strong>ï¼šç ”ç©¶è«–æ–‡æ•°ã¯æ¨ªã°ã„ã¾ãŸã¯å¾®æ¸›â†’æ—¢å­˜è£½å“ã®æ·˜æ±°ãŒé€²è¡Œâ†’æ–°è¦è¨´æ±‚ã¾ãŸã¯æŠ€è¡“é©æ–°ã«ã‚ˆã‚Šä¸€éƒ¨ã§å¾©æ´»ã®å¯èƒ½æ€§â†’å¸‚å ´ã¯ç¸®å°ã¾ãŸã¯æ¨ªã°ã„`;
            }

            return `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px; font-size: 1.1em; margin-bottom: 10px;">
                        <span style="font-size: 1.5em;">${trendIcon}</span>
                        <strong>æˆé•·ç‡åˆ†æ</strong>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 5px; line-height: 1.6;">
                        ${analysis}
                    </div>
                    ${specificAnalysis ? `
                    <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.15); border-radius: 5px; font-size: 0.9em;">
                        <strong>ğŸ” ${name}å›ºæœ‰ã®è¦å› ï¼š</strong><br>${specificAnalysis}
                    </div>
                    ` : ''}
                    <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; font-size: 0.9em; line-height: 1.6;">
                        ${marketImplication}
                    </div>
                    <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; font-size: 0.85em; line-height: 1.6;">
                        ${timeline}
                    </div>
                </div>
            `;
        }

        // æˆåˆ†ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼å›ºæœ‰ã®åˆ†æã‚’å–å¾—
        function getSpecificAnalysis(name, growth, papers) {
            const analyses = {
                'NMN': growth > 0 ?
                    'NMNå¸‚å ´ã¯2024å¹´159å„„å††â†’2031å¹´305å„„å††ã¸ã®æˆé•·äºˆæ¸¬ã€‚é•·å¯¿éºä¼å­ï¼ˆã‚µãƒ¼ãƒãƒ¥ã‚¤ãƒ³ï¼‰æ´»æ€§åŒ–ã¨ã„ã†æ˜ç¢ºãªå·®åˆ¥åŒ–è¦å› ãŒã‚ã‚Šã€å¯Œè£•å±¤ãƒ»å¥åº·æ„è­˜ã®é«˜ã„å±¤ã¸ã®è¨´æ±‚åŠ›ãŒå¼·ã„ã€‚' :
                    'NAD+ãƒ–ãƒ¼ã‚¹ã‚¿ãƒ¼å¸‚å ´å…¨ä½“ã¯æˆé•·ä¸­ã ãŒã€NMNã®å®‰å…¨æ€§ã‚„å¸åç‡ã«é–¢ã™ã‚‹è­°è«–ãŒå½±éŸ¿ã—ã¦ã„ã‚‹å¯èƒ½æ€§ã€‚NRãªã©ä»–ã®NAD+å‰é§†ä½“ã¨ã®ç«¶åˆã‚‚æ¿€åŒ–ã€‚',
                'ãƒ—ãƒ­ãƒã‚¤ã‚ªãƒ†ã‚£ã‚¯ã‚¹': growth > 0 ?
                    'ç´„6,000å„„å††å¸‚å ´ã®å·¨å¤§ã‚«ãƒ†ã‚´ãƒªãƒ¼ã€‚è…¸æ´»ãƒ–ãƒ¼ãƒ ã®ç¶™ç¶šã€å…ç–«ãƒ»ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹ã¸ã®å¤šæ§˜ãªè¨´æ±‚ã€ã‚·ãƒ³ãƒã‚¤ã‚ªãƒ†ã‚£ã‚¯ã‚¹è£½å“ã®å¢—åŠ ãŒæˆé•·ã‚’å¾ŒæŠ¼ã—ã€‚' :
                    'å¸‚å ´ã¯å·¨å¤§ã ãŒæˆç†ŸåŒ–ã€‚èŒæ ªã®å·®åˆ¥åŒ–ã€å€‹åˆ¥åŒ–ãƒ—ãƒ­ãƒã‚¤ã‚ªãƒ†ã‚£ã‚¯ã‚¹ã€æ¬¡ä¸–ä»£ãƒ—ãƒ­ãƒã‚¤ã‚ªãƒ†ã‚£ã‚¯ã‚¹ï¼ˆã‚¢ãƒƒã‚«ãƒ¼ãƒãƒ³ã‚·ã‚¢ç­‰ï¼‰ã¸ã®ç§»è¡ŒãŒé€²ã‚“ã§ã„ã‚‹ã€‚',
                'ã‚³ãƒ©ãƒ¼ã‚²ãƒ³': growth > 0 ?
                    'ç¾å®¹ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆå¸‚å ´ã®ä¸­æ ¸ï¼ˆ228ã€œ700å„„å††ï¼‰ã€‚ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰éœ€è¦ã®å›å¾©ã€ç”·æ€§ç¾å®¹å¸‚å ´ã®æ‹¡å¤§ã€ãƒˆãƒªãƒšãƒ—ãƒãƒ‰ç­‰ã®å¸åå‹è£½å“ã®å¢—åŠ ãŒæˆé•·ã‚’ç‰½å¼•ã€‚' :
                    'å¸‚å ´ã¯æˆç†Ÿã—ã¦ã„ã‚‹ãŒã€æ–°è¦è¨´æ±‚ï¼ˆé–¢ç¯€ã€éª¨ã€è…¸ãƒãƒªã‚¢æ©Ÿèƒ½ï¼‰ã‚„ã€é­šç”±æ¥ã‚³ãƒ©ãƒ¼ã‚²ãƒ³ã€ãƒ“ãƒ¼ã‚¬ãƒ³ä»£æ›¿å“ã®é–‹ç™ºã«ã‚ˆã‚Šå†æˆé•·ã®å¯èƒ½æ€§ã€‚',
                'ã‚¯ãƒ«ã‚¯ãƒŸãƒ³': growth > 0 ?
                    '250ã€œ300å„„å††å¸‚å ´ã€‚é«˜å¸åå‹ï¼ˆãƒŠãƒåŒ–ãƒ»ãƒªãƒã‚½ãƒ¼ãƒ åŒ–ï¼‰è£½å“ã®ç™»å ´ã«ã‚ˆã‚Šæ©Ÿèƒ½æ€§ãŒå‘ä¸Šã€‚æŠ—ç‚ç—‡ãƒ»æŠ—é…¸åŒ–ã®å¤šæ©Ÿèƒ½æ€§ãŒè©•ä¾¡ã•ã‚Œã€å¹…åºƒã„ç”¨é€”ã§éœ€è¦æ‹¡å¤§ã€‚' :
                    'å¸åç‡ã®ä½ã•ãŒèª²é¡Œã ã£ãŸãŒã€æŠ€è¡“é©æ–°ã«ã‚ˆã‚Šè§£æ±ºã€‚ãŸã ã—å¸‚å ´ã¯ç«¶äº‰æ¿€åŒ–ã—ã¦ãŠã‚Šã€å·®åˆ¥åŒ–ãŒé‡è¦ã€‚',
                'GABA': growth > 0 ?
                    'æ©Ÿèƒ½æ€§è¡¨ç¤ºé£Ÿå“ã®ä¸»åŠ›ã‚«ãƒ†ã‚´ãƒªãƒ¼ã€‚ç¡çœ ãƒ»ã‚¹ãƒˆãƒ¬ã‚¹å¸‚å ´ã®æ‹¡å¤§ã«ã‚ˆã‚Šéœ€è¦æ€¥å¢—ã€‚ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆãƒ»ã‚°ãƒŸãªã©æ‰‹è»½ãªå‰¤å½¢ã®å¢—åŠ ãŒæ¶ˆè²»è€…å±¤ã‚’æ‹¡å¤§ã€‚' :
                    'ç«¶åˆæˆåˆ†ï¼ˆL-ãƒ†ã‚¢ãƒ‹ãƒ³ç­‰ï¼‰ã¨ã®å·®åˆ¥åŒ–ãŒèª²é¡Œã€‚è¤‡åˆé…åˆè£½å“ã¸ã®ã‚·ãƒ•ãƒˆãŒé€²ã‚“ã§ã„ã‚‹ã€‚',
                'ãƒ“ã‚¿ãƒŸãƒ³D': growth > 0 ?
                    'æ—¥æœ¬äººã®ç´„50%ãŒæ¬ ä¹çŠ¶æ…‹ã¨ã„ã†æ·±åˆ»ãªçŠ¶æ³ãŒèªçŸ¥ã•ã‚Œã€éœ€è¦ãŒæ€¥æ‹¡å¤§ã€‚å…ç–«æ©Ÿèƒ½ãƒ»éª¨å¥åº·ã®ä¸¡é¢ã‹ã‚‰è¨´æ±‚å¯èƒ½ã§ã€COVID-19ä»¥é™ã•ã‚‰ã«æ³¨ç›®åº¦ãŒå‘ä¸Šã€‚' :
                    'èªçŸ¥ãŒåºƒã¾ã‚Šã€å¸‚å ´ã¯æˆç†ŸåŒ–ã€‚éå‰°æ‘‚å–ã¸ã®æ³¨æ„å–šèµ·ã‚‚å¢—åŠ ã—ã¦ãŠã‚Šã€é©åˆ‡ãªç”¨é‡è¨­å®šãŒé‡è¦ã€‚',
                'EPA': growth > 0 ?
                    'ä¸­æ€§è„‚è‚ªä½æ¸›ã®æ©Ÿèƒ½æ€§è¡¨ç¤ºé£Ÿå“ã¨ã—ã¦ç¢ºå›ºãŸã‚‹åœ°ä½ã€‚DHAã¨ã®è¤‡åˆé…åˆã«ã‚ˆã‚Šã€å¿ƒè¡€ç®¡ãƒ»èªçŸ¥æ©Ÿèƒ½ã®ä¸¡é¢ã‹ã‚‰è¨´æ±‚ã€‚é«˜ç´”åº¦EPAè£½å“ã®å¢—åŠ ã€‚' :
                    'é­šæ²¹ã®é…¸åŒ–ãƒ»è‡­ã„ã®å•é¡Œã€æ¤ç‰©ç”±æ¥ã‚ªãƒ¡ã‚¬3ï¼ˆè—»é¡ç”±æ¥ç­‰ï¼‰ã¨ã®ç«¶åˆãŒèª²é¡Œã€‚æŒç¶šå¯èƒ½æ€§ï¼ˆæ¼æ¥­è³‡æºï¼‰ã¸ã®é…æ…®ã‚‚å¿…è¦ã€‚',
                'DHA': growth > 0 ?
                    'èªçŸ¥æ©Ÿèƒ½ç¶­æŒã®è¨´æ±‚ã§ä¸­é«˜å¹´å±¤ã«äººæ°—ã€‚ã€Œä¸­é«˜å¹´ã®è¨˜æ†¶åŠ›ã‚’ç¶­æŒã€æ©Ÿèƒ½æ€§è¡¨ç¤ºé£Ÿå“ãŒå¤šæ•°ç™»å ´ã€‚å—é¨“ç”Ÿå‘ã‘å¸‚å ´ã‚‚æ‹¡å¤§ä¸­ã€‚' :
                    'EPAåŒæ§˜ã€é…¸åŒ–å®‰å®šæ€§ã¨æŒç¶šå¯èƒ½æ€§ãŒèª²é¡Œã€‚è—»é¡ç”±æ¥DHAã¸ã®ã‚·ãƒ•ãƒˆãŒé€²è¡Œä¸­ã€‚',
                'ç¾è‚Œ': growth > 0 ?
                    'ç¾å®¹ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆå¸‚å ´ã¯2024å¹´å‰å¹´æ¯”48.1%å¢—ã¨æ€¥æˆé•·ã€‚ã‚¤ãƒ³ãƒŠãƒ¼ãƒ“ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ¼ã®æ¦‚å¿µãŒæµ¸é€ã—ã€å¤–ç”¨+å†…æœã®ãƒ€ãƒ–ãƒ«ã‚±ã‚¢ãŒä¸»æµåŒ–ã€‚' :
                    'å¸‚å ´ã¯é£½å’Œæ°—å‘³ã§ã€æ–°è¦è¨´æ±‚ï¼ˆãƒ–ãƒ«ãƒ¼ãƒ©ã‚¤ãƒˆå¯¾ç­–ã€è…¸è‚Œç›¸é–¢ç­‰ï¼‰ãŒå¿…è¦ã€‚ç”·æ€§ç¾å®¹å¸‚å ´ã¸ã®å±•é–‹ãŒæ¬¡ã®æˆé•·æ©Ÿä¼šã€‚',
                'æŠ—è€åŒ–': growth > 0 ?
                    'NMNå¸‚å ´ã®æ‹¡å¤§ï¼ˆ159â†’305å„„å††äºˆæ¸¬ï¼‰ãŒç‰½å¼•ã€‚é•·å¯¿éºä¼å­ãƒ»ãƒ†ãƒ­ãƒ¡ã‚¢ãƒ»ãƒŸãƒˆã‚³ãƒ³ãƒ‰ãƒªã‚¢ãªã©ã€åˆ†å­ç”Ÿç‰©å­¦çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒæ¶ˆè²»è€…ã«å—ã‘å…¥ã‚Œã‚‰ã‚Œã¦ã„ã‚‹ã€‚' :
                    'é«˜ä¾¡æ ¼å¸¯è£½å“ãŒå¤šãã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒé™å®šçš„ã€‚ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã®æ›´ãªã‚‹è“„ç©ã¨ã€ä¸­ä¾¡æ ¼å¸¯è£½å“ã®é–‹ç™ºãŒæ™®åŠã®éµã€‚',
                'è…¸å†…ç’°å¢ƒ': growth > 0 ?
                    'ãƒ—ãƒ­ãƒã‚¤ã‚ªãƒ†ã‚£ã‚¯ã‚¹6,000å„„å††å¸‚å ´ã®åŸºç›¤ã€‚è„³è…¸ç›¸é–¢ã®èªçŸ¥æ‹¡å¤§ã«ã‚ˆã‚Šã€ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹ãƒ»ç¾å®¹ãƒ»å…ç–«ã®åŒ…æ‹¬çš„è¨´æ±‚ãŒå¯èƒ½ã«ã€‚å€‹åˆ¥åŒ–è…¸å†…ãƒ•ãƒ­ãƒ¼ãƒ©æ¤œæŸ»ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®é€£æºã‚‚ã€‚' :
                    'èŒæ ªã®å·®åˆ¥åŒ–ãŒå›°é›£ã«ãªã£ã¦ãŠã‚Šã€ã‚·ãƒ³ãƒã‚¤ã‚ªãƒ†ã‚£ã‚¯ã‚¹ã€ãƒã‚¹ãƒˆãƒã‚¤ã‚ªãƒ†ã‚£ã‚¯ã‚¹ã¸ã®ç§»è¡ŒãŒé€²è¡Œã€‚',
                'èªçŸ¥æ©Ÿèƒ½': growth > 0 ?
                    '2025å¹´èªçŸ¥ç—‡æ‚£è€…700ä¸‡äººäºˆæ¸¬ã¨ã„ã†ç¤¾ä¼šèª²é¡ŒãŒèƒŒæ™¯ã€‚DHAãƒ»ã‚¤ãƒãƒ§ã‚¦è‘‰ã‚¨ã‚­ã‚¹ã®æ©Ÿèƒ½æ€§è¡¨ç¤ºé£Ÿå“ãŒå¢—åŠ ã€‚å—é¨“ç”Ÿãƒ»ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ã‚½ãƒ³å‘ã‘å¸‚å ´ã‚‚æ‹¡å¤§ã€‚' :
                    'åŠ¹æœã®å®Ÿæ„ŸãŒå¾—ã«ãã„åˆ†é‡ã®ãŸã‚ã€ç¶™ç¶šç‡ã®å‘ä¸ŠãŒèª²é¡Œã€‚è„³ç”»åƒç ”ç©¶ãªã©ã€è¦–è¦šçš„ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã®æç¤ºãŒæœ‰åŠ¹ã€‚',
                'ç¡çœ ã®è³ª': growth > 0 ?
                    'ç¾ä»£äººã®ç´„3å‰²ãŒç¡çœ ä¸æº€ã‚’æŠ±ãˆã€ç¡çœ è² å‚µãŒç¤¾ä¼šå•é¡ŒåŒ–ã€‚GABAãƒ»L-ãƒ†ã‚¢ãƒ‹ãƒ³è£½å“ãŒæ€¥å¢—ã€‚ã‚¦ã‚§ã‚¢ãƒ©ãƒ–ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã¨ã®é€£æºã«ã‚ˆã‚ŠåŠ¹æœã®å¯è¦–åŒ–ãŒé€²ã‚€ã€‚' :
                    'ç«¶åˆæˆåˆ†ãŒå¤šãã€å·®åˆ¥åŒ–ãŒå›°é›£ã€‚è¤‡åˆé…åˆã€æ–°è¦å‰¤å½¢ï¼ˆã‚°ãƒŸãƒ»ãƒãƒ§ã‚³ï¼‰ã§ã®å±•é–‹ãŒä¸»æµã«ã€‚',
                'ã‚¹ãƒˆãƒ¬ã‚¹ç·©å’Œ': growth > 0 ?
                    'ã‚³ãƒ­ãƒŠç¦ä»¥é™ã€ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹å¸‚å ´ãŒæ€¥æ‹¡å¤§ã€‚ã‚¢ã‚·ãƒ¥ãƒ¯ã‚¬ãƒ³ãƒ€ç­‰ã®ã‚¢ãƒ€ãƒ—ãƒˆã‚²ãƒ³ãŒæ³¨ç›®ã•ã‚Œã€æ–°è¦å¸‚å ´ã‚’å½¢æˆã€‚ã€Œä¸€æ™‚çš„ãªä¸å®‰ã‚’å’Œã‚‰ã’ã‚‹ã€è¨´æ±‚ã®æ©Ÿèƒ½æ€§è¡¨ç¤ºé£Ÿå“ãŒå¢—åŠ ã€‚' :
                    'åŠ¹æœã®å€‹äººå·®ãŒå¤§ããã€ç¶™ç¶šç‡å‘ä¸ŠãŒèª²é¡Œã€‚ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ç­‰ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®çµ„ã¿åˆã‚ã›ãŒæœ‰åŠ¹ã€‚',
            };
            return analyses[name] || '';
        }

        // ãƒˆãƒ”ãƒƒã‚¯è©³ç´°è¡¨ç¤º
        function showTopicDetail(topic) {
            document.getElementById('modal-title').textContent = topic.name;

            // ã‚«ãƒ†ã‚´ãƒªãƒ¼è©³ç´°æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ç”Ÿæˆ
            let categoryDetailSection = '';
            if (topic.categoryDetail && Object.keys(topic.categoryDetail).length > 0) {
                const detail = topic.categoryDetail;
                categoryDetailSection = `
                    <div style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: #667eea; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.5em;">ğŸ“‹</span>
                            ã‚«ãƒ†ã‚´ãƒªãƒ¼è©³ç´°æƒ…å ±
                        </h4>

                        ${detail.description ? `
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; line-height: 1.8;">
                                <strong style="color: #667eea;">ğŸ“– ã‚«ãƒ†ã‚´ãƒªãƒ¼æ¦‚è¦ï¼š</strong>
                                <p style="margin-top: 8px; color: #333;">${detail.description}</p>
                            </div>
                        ` : ''}

                        ${detail.benefits && detail.benefits.length > 0 ? `
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <strong style="color: #667eea;">âœ¨ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœï¼š</strong>
                                <ul style="margin-top: 8px; padding-left: 20px; line-height: 1.8; color: #333;">
                                    ${detail.benefits.map(benefit => `<li>${benefit}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}

                        ${detail.background ? `
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; line-height: 1.8;">
                                <strong style="color: #667eea;">ğŸŒ å¸‚å ´èƒŒæ™¯ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰ï¼š</strong>
                                <p style="margin-top: 8px; color: #333;">${detail.background}</p>
                            </div>
                        ` : ''}

                        ${detail.target ? `
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; line-height: 1.8;">
                                <strong style="color: #667eea;">ğŸ¯ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ï¼š</strong>
                                <p style="margin-top: 8px; color: #333;">${detail.target}</p>
                            </div>
                        ` : ''}

                        ${detail.market_size ? `
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; line-height: 1.8;">
                                <strong style="color: #667eea;">ğŸ’° å¸‚å ´è¦æ¨¡ï¼š</strong>
                                <p style="margin-top: 8px; color: #333;">${detail.market_size}</p>
                            </div>
                        ` : ''}

                        ${detail.key_ingredients && detail.key_ingredients.length > 0 ? `
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <strong style="color: #667eea;">ğŸ§ª ä¸»è¦æˆåˆ†ã¨æ¨å¥¨ç”¨é‡ï¼š</strong>
                                <ul style="margin-top: 8px; padding-left: 20px; line-height: 1.8; color: #333;">
                                    ${detail.key_ingredients.map(ingredient => `<li>${ingredient}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}

                        ${detail.scientific_evidence ? `
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; line-height: 1.8;">
                                <strong style="color: #667eea;">ğŸ”¬ ç§‘å­¦çš„ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ï¼š</strong>
                                <p style="margin-top: 8px; color: #333;">${detail.scientific_evidence}</p>
                            </div>
                        ` : ''}

                        ${detail.trends && detail.trends.length > 0 ? `
                            <div style="background: white; padding: 15px; border-radius: 8px; line-height: 1.8;">
                                <strong style="color: #667eea;">ğŸ“ˆ ç¾åœ¨ã®ãƒˆãƒ¬ãƒ³ãƒ‰ï¼š</strong>
                                <ul style="margin-top: 8px; padding-left: 20px; line-height: 1.8; color: #333;">
                                    ${detail.trends.map(trend => `<li>${trend}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            let modalContent = `
                ${categoryDetailSection}
                ${analyzeGrowthRate(topic)}

                <div style="margin-bottom: 20px;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">æ¦‚è¦</h4>
                    <p>${topic.summary}</p>
                </div>

                <div style="margin-bottom: 20px;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">ä¸»è¦ãªç™ºè¦‹</h4>
                    ${topic.keyFindings.map(finding =>
                        `<div class="finding-item">â€¢ ${finding}</div>`
                    ).join('')}
                </div>

                <div style="margin-bottom: 20px;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">å¸‚å ´è¦æ¨¡</h4>
                    <p>${topic.marketSize}</p>
                </div>

                <div style="margin-bottom: 20px;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">å¿œç”¨åˆ†é‡</h4>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        ${topic.applications.map(app =>
                            `<span style="background: #667eea; color: white; padding: 5px 10px; border-radius: 5px;">${app}</span>`
                        ).join('')}
                    </div>
                </div>

                ${topic.dosage !== 'N/A' ? `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">æ¨å¥¨æ‘‚å–é‡</h4>
                    <p>${topic.dosage}</p>
                </div>
                ` : ''}

                <div style="margin-bottom: 20px;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">å®‰å…¨æ€§</h4>
                    <p>${topic.safety}</p>
                </div>

                <div>
                    <h4 style="color: #667eea; margin-bottom: 10px;">æœ€è¿‘ã®è«–æ–‡</h4>
                    ${topic.recentPapers.map(paper => `
                        <div class="paper-item">
                            <div class="paper-title">${paper.title}</div>
                            <div class="paper-meta">${paper.journal} â€¢ ${paper.date}</div>
                        </div>
                    `).join('')}
                </div>
            `;

            document.getElementById('modal-body').innerHTML = modalContent;
            document.getElementById('topic-modal').classList.add('active');
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeModal() {
            document.getElementById('topic-modal').classList.remove('active');
        }

        // ãƒãƒ£ãƒ¼ãƒˆåˆæœŸåŒ–
        function initCharts() {
            // ãƒˆãƒ¬ãƒ³ãƒ‰ãƒãƒ£ãƒ¼ãƒˆ
            const trendCtx = document.getElementById('ingredient-trend-chart').getContext('2d');
            trendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ['6ãƒ¶æœˆå‰', '5ãƒ¶æœˆå‰', '4ãƒ¶æœˆå‰', '3ãƒ¶æœˆå‰', '2ãƒ¶æœˆå‰', '1ãƒ¶æœˆå‰'],
                    datasets: dataStore.ingredients.slice(0, 5).map((ing, idx) => ({
                        label: ing.name,
                        data: ing.trends,
                        borderColor: `hsl(${idx * 72}, 70%, 50%)`,
                        backgroundColor: `hsla(${idx * 72}, 70%, 50%, 0.1)`,
                        tension: 0.4
                    }))
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ä¸»è¦æˆåˆ†ã®ãƒˆãƒ¬ãƒ³ãƒ‰æ¨ç§»'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'æ³¨ç›®åº¦'
                            }
                        }
                    }
                }
            });

            // ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ãƒãƒ£ãƒ¼ãƒˆ
            const evidenceCtx = document.getElementById('evidence-chart').getContext('2d');
            evidenceChart = new Chart(evidenceCtx, {
                type: 'bar',
                data: {
                    labels: dataStore.ingredients.slice(0, 10).map(i => i.name),
                    datasets: [{
                        label: 'ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹æ•°',
                        data: dataStore.ingredients.slice(0, 10).map(i => i.evidence),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'æˆåˆ†åˆ¥ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹æ•°'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'è«–æ–‡æ•°'
                            }
                        }
                    }
                }
            });
        }

        // å®Ÿç”¨åŒ–ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
        function updateCommercializationRanking() {
            const container = document.getElementById('commercialization-ranking');
            if (!dataStore.commercializationScores) {
                container.innerHTML = '<p style="text-align: center; color: #999;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            const scores = dataStore.commercializationScores;

            let html = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <th style="padding: 15px; text-align: center; border-radius: 8px 0 0 0;">é †ä½</th>
                            <th style="padding: 15px; text-align: left;">æˆåˆ†å</th>
                            <th style="padding: 15px; text-align: center;">ç·åˆã‚¹ã‚³ã‚¢</th>
                            <th style="padding: 15px; text-align: center;">è«–æ–‡æ•°</th>
                            <th style="padding: 15px; text-align: center;">æˆé•·ç‡</th>
                            <th style="padding: 15px; text-align: center;">å®‰å…¨æ€§</th>
                            <th style="padding: 15px; text-align: center;">åŠ¹æœ</th>
                            <th style="padding: 15px; text-align: center; border-radius: 0 8px 0 0;">å¸‚å ´æ€§</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ç”Ÿæˆé–¢æ•°
            const createProgressBar = (score, maxScore = 10) => {
                const percentage = (score / maxScore) * 100;
                let barColor = '#10b981';
                if (score >= 9) barColor = '#10b981';
                else if (score >= 7) barColor = '#34d399';
                else if (score >= 5) barColor = '#fbbf24';
                else barColor = '#f59e0b';

                return `
                    <div style="display: flex; align-items: center; gap: 8px; justify-content: center;">
                        <div style="flex: 0 0 80px; background: #e5e7eb; height: 10px; border-radius: 5px; overflow: hidden;">
                            <div style="width: ${percentage}%; background: ${barColor}; height: 100%; border-radius: 5px; transition: width 0.3s ease;"></div>
                        </div>
                        <span style="font-weight: 600; min-width: 30px; font-size: 0.9rem; color: #1f2937;">${score}/10</span>
                    </div>
                `;
            };

            scores.forEach((item, index) => {
                const rankClass = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index + 1}`;
                const rowBg = index % 2 === 0 ? '#f8f9fa' : 'white';
                const scoreColor = item.totalScore >= 70 ? '#10b981' : item.totalScore >= 60 ? '#f59e0b' : '#6b7280';

                html += `
                    <tr style="background: ${rowBg}; border-bottom: 1px solid #e5e7eb; cursor: pointer; transition: all 0.2s;"
                        onmouseover="this.style.background='#e0e7ff'"
                        onmouseout="this.style.background='${rowBg}'"
                        onclick="showScoreDetail(${JSON.stringify(item).replace(/"/g, '&quot;')})">
                        <td style="padding: 12px; text-align: center; font-size: 1.2rem; font-weight: bold;">
                            ${rankClass}
                        </td>
                        <td style="padding: 12px; font-weight: 600; color: #1f2937;">
                            ${item.name}
                        </td>
                        <td style="padding: 12px; text-align: center;">
                            <div style="display: inline-block; background: ${scoreColor}; color: white; padding: 6px 12px; border-radius: 20px; font-weight: bold; font-size: 1.1rem;">
                                ${item.totalScore}
                            </div>
                        </td>
                        <td style="padding: 12px; text-align: center; color: #6b7280;">
                            ${item.paperCount}ä»¶
                        </td>
                        <td style="padding: 12px; text-align: center; color: ${item.growthRate >= 100 ? '#10b981' : item.growthRate >= 50 ? '#f59e0b' : '#6b7280'}; font-weight: 600;">
                            ${item.growthRate >= 0 ? '+' : ''}${item.growthRate}%
                        </td>
                        <td style="padding: 12px;">
                            ${createProgressBar(item.safetyScore)}
                        </td>
                        <td style="padding: 12px;">
                            ${createProgressBar(item.efficacyScore)}
                        </td>
                        <td style="padding: 12px;">
                            ${createProgressBar(item.marketScore)}
                        </td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
            `;

            container.innerHTML = html;
        }

        // ã‚¹ã‚³ã‚¢è©³ç´°è¡¨ç¤º
        function showScoreDetail(item) {
            document.getElementById('modal-title').textContent = `${item.name} - å®Ÿç”¨åŒ–ã‚¹ã‚³ã‚¢è©³ç´°`;

            const breakdown = item.scoreBreakdown;
            let modalContent = `
                <div style="margin-bottom: 30px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 2.5rem; font-weight: bold;">${item.totalScore}</div>
                        <div style="font-size: 1.1rem; opacity: 0.9;">ç·åˆã‚¹ã‚³ã‚¢</div>
                    </div>

                    <h4 style="color: #667eea; margin-bottom: 15px;">ğŸ“Š ã‚¹ã‚³ã‚¢å†…è¨³</h4>
                    <div style="display: grid; gap: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f3f4f6; border-radius: 8px;">
                            <span style="font-weight: 600;">è«–æ–‡æ•°ã‚¹ã‚³ã‚¢ (25%)</span>
                            <div style="flex: 1; margin: 0 15px; background: #e5e7eb; height: 8px; border-radius: 4px; overflow: hidden;">
                                <div style="width: ${breakdown.paperScore}%; background: #667eea; height: 100%;"></div>
                            </div>
                            <span style="font-weight: bold; color: #667eea;">${breakdown.paperScore}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f3f4f6; border-radius: 8px;">
                            <span style="font-weight: 600;">æˆé•·ç‡ã‚¹ã‚³ã‚¢ (30%)</span>
                            <div style="flex: 1; margin: 0 15px; background: #e5e7eb; height: 8px; border-radius: 4px; overflow: hidden;">
                                <div style="width: ${breakdown.growthScore}%; background: #10b981; height: 100%;"></div>
                            </div>
                            <span style="font-weight: bold; color: #10b981;">${breakdown.growthScore}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f3f4f6; border-radius: 8px;">
                            <span style="font-weight: 600;">å®‰å…¨æ€§ã‚¹ã‚³ã‚¢ (20%)</span>
                            <div style="flex: 1; margin: 0 15px; background: #e5e7eb; height: 8px; border-radius: 4px; overflow: hidden;">
                                <div style="width: ${breakdown.safetyScore}%; background: #f59e0b; height: 100%;"></div>
                            </div>
                            <span style="font-weight: bold; color: #f59e0b;">${breakdown.safetyScore}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f3f4f6; border-radius: 8px;">
                            <span style="font-weight: 600;">åŠ¹æœã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ (15%)</span>
                            <div style="flex: 1; margin: 0 15px; background: #e5e7eb; height: 8px; border-radius: 4px; overflow: hidden;">
                                <div style="width: ${breakdown.efficacyScore}%; background: #8b5cf6; height: 100%;"></div>
                            </div>
                            <span style="font-weight: bold; color: #8b5cf6;">${breakdown.efficacyScore}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f3f4f6; border-radius: 8px;">
                            <span style="font-weight: 600;">å¸‚å ´æ€§ã‚¹ã‚³ã‚¢ (10%)</span>
                            <div style="flex: 1; margin: 0 15px; background: #e5e7eb; height: 8px; border-radius: 4px; overflow: hidden;">
                                <div style="width: ${breakdown.marketScore}%; background: #ec4899; height: 100%;"></div>
                            </div>
                            <span style="font-weight: bold; color: #ec4899;">${breakdown.marketScore}</span>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">ğŸ“ˆ ä¸»è¦æŒ‡æ¨™</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div style="padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #667eea;">
                            <div style="color: #6b7280; font-size: 0.85rem;">ç ”ç©¶è«–æ–‡æ•°</div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #1f2937;">${item.paperCount}ä»¶</div>
                        </div>
                        <div style="padding: 15px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981;">
                            <div style="color: #6b7280; font-size: 0.85rem;">æˆé•·ç‡</div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #1f2937;">${item.growthRate >= 0 ? '+' : ''}${item.growthRate}%</div>
                        </div>
                        <div style="padding: 15px; background: #fffbeb; border-radius: 8px; border-left: 4px solid #f59e0b;">
                            <div style="color: #6b7280; font-size: 0.85rem;">è‡¨åºŠè©¦é¨“æ•°</div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #1f2937;">${item.clinicalTrials}ä»¶</div>
                        </div>
                        <div style="padding: 15px; background: #faf5ff; border-radius: 8px; border-left: 4px solid #8b5cf6;">
                            <div style="color: #6b7280; font-size: 0.85rem;">è©•ä¾¡</div>
                            <div style="font-size: 1.2rem; font-weight: bold; color: #1f2937;">
                                ${item.totalScore >= 70 ? 'ğŸŒŸ å¼·ãæ¨å¥¨' : item.totalScore >= 60 ? 'â­ æ¨å¥¨' : 'ğŸ“Š æ¤œè¨ä¸­'}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('modal-content').innerHTML = modalContent;
            document.getElementById('topic-modal').style.display = 'block';
        }

        // ESCã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>